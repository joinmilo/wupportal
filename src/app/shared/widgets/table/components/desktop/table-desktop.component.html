<mat-card [formGroup]="form">
  <table mat-table [dataSource]="((data | async)?.result || [])" matSort matSortDisableClear>

    <ng-container *ngFor="let column of columns"
      [matColumnDef]="column.field">
      <th mat-header-cell
        *matHeaderCellDef
        mat-sort-header
        [disabled]="!column.sort">
        <strong [appLabel]="column.label"></strong>
      </th>

      <td mat-cell *matCellDef="let row"
        [class.clickable]="clickable"
        (click)="rowClicked.emit(row)">
        <mat-form-field *ngIf="inlineEditMode
          && column.editable
          && row.id === editRow?.id; else rowTemplate"
          appearance="outline"
          [hideRequiredMarker]="true">
          <mat-label [appLabel]="row.label"></mat-label>
          <input matInput [formControlName]="column.field">
        </mat-form-field>
        
        <ng-template #rowTemplate>
          <div
            [appRow]="row"
            [column]="column">
          </div>
        </ng-template>
      </td>
    </ng-container>

    <ng-container *ngIf="actions" matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef>
        <strong appLabel="actions"></strong>
      </th>

      <td *matCellDef="let row"
        mat-cell>
        <div class="actions">

          <ng-container *ngIf="inlineEditMode
            && row?.id === editRow?.id; else actionsTemplate">
            <button mat-button
              class="save"
              appTooltip="save"
              (click)="save(row)">
              <fa-icon [icon]="['fas', 'check']"></fa-icon>
            </button>

            <button mat-button
              appTooltip="cancel"
              (click)="disableInlineEdit()">
              <fa-icon [icon]="['fas', 'xmark']"></fa-icon>
            </button>
          </ng-container>
  
          <ng-template #actionsTemplate>
            <ng-container>
              <button *ngIf="inlineEditAction"
                mat-button
                [appTooltip]="inlineEditAction.tooltipLabel"
                (click)="enableInlineEdit(row)">
                <fa-icon [icon]="['fas', inlineEditAction.icon]"></fa-icon>
              </button>

              <app-table-actions
                [actions]="actions"
                [entity]="entity"
                [data]="row">
              </app-table-actions>
            </ng-container>
          </ng-template>
        </div>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns;"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
  </table>
</mat-card>

<mat-card>
  <app-table-paginator
    [length]="(data | async)?.total"
    [pageSize]="initParams?.size"
    [pageIndex]="initParams?.page">
  </app-table-paginator>
</mat-card>